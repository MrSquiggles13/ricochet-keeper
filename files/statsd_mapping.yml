mappings:
  - match: "(.+)\\.(.+)_start$"
    match_metric_type: counter
    name: "airflow_job_start"
    match_type: regex
    labels:
      job_name: "$1"
  - match: "(.+)\\.(.+)_end$"
    match_metric_type: counter
    name: "airflow_job_end"
    match_type: regex
    labels:
      job_name: "$1"

  - match: "*.ti_failures"
    match_metric_type: counter
    name: "airflow_ti_failures"
  - match: "*.ti_successes"
    match_metric_type: counter
    name: "airflow_ti_successes"
  - match: "*.zombies_killed"
    match_metric_type: counter
    name: "airflow_zombies_killed"

  - match: "*.dag_processing.processes"
    match_metric_type: counter
    name: "airflow_dag_processing_processes"

  - match: "*.scheduler.tasks.killed_externally"
    match_metric_type: counter
    name: "airflow_scheduler_tasks_killed_externally"

  - match: "*.scheduler.tasks.running"
    match_metric_type: counter
    name: "airflow_scheduler_tasks_running"
  - match: "*.scheduler.tasks.starving"
    match_metric_type: counter
    name: "airflow_scheduler_tasks_starving"
  - match: "*.scheduler.orphaned_tasks.cleared"
    match_metric_type: counter
    name: "airflow_scheduler_orphaned_tasks_cleared"
  - match: "*.scheduler.orphaned_tasks.adopted"
    match_metric_type: counter
    name: "airflow_scheduler_orphaned_tasks_adopted"

  - match: "*.scheduler.critical_section_busy"
    match_metric_type: counter
    name: "airflow_scheduler_critical_section_busy"

  - match: "*.ti.start.*.*"
    match_metric_type: counter
    name: "airflow_ti_start"
    labels:
      dag_id: "$1"
      task_id: "$2"
  - match: "*.ti.finish.*.*.*"
    match_metric_type: counter
    name: "airflow_ti_finish"
    labels:
      dag_id: "$1"
      task_id: "$2"
      state: "$3"

  - match: "*.dag.callback_exceptions"
    match_metric_type: counter
    name: "airflow_dag_callback_exceptions"
  - match: "*.celery.task_timeout_error"
    match_metric_type: counter
    name: "airflow_celery_task_timeout_error"

  - match: "*.dag_processing.processor_timeouts"
    match_metric_type: gauge
    name: "airflow_dag_processing_processor_timeouts"

  - match: "*.dagrun.dependency-check.*"
    match_metric_type: observer
    help: Milliseconds taken to check DAG dependencies
    name: "airflow_dagrun_dependency_check"
    labels:
      dag_id: "$1"

  - match: airflow.operator_successes_(.*)
    match_type: regex
    name: "airflow_operator_successes"
    labels:
      operator: "$1"

  - match: airflow.operator_failures_(.*)
    match_type: regex
    name: "airflow_operator_failures"
    labels:
      operator: "$1"

  - match: airflow.scheduler_heartbeat
    match_type: regex
    name: "airflow_scheduler_heartbeat"
    labels:
      type: counter

  - match: airflow.dag.*.*.duration
    name: "airflow_task_duration"
    match_metric_type: observer
    labels:
      dag_id: "$1"
      task_id: "$2"

  - match: "*.dagrun.duration.success.*"
    match_metric_type: observer
    name: "airflow_dagrun_duration_success"
    labels:
      dag_id: "$1"

  - match: "*.dagrun.duration.failed.*"
    match_metric_type: observer
    name: "airflow_dagrun_duration_failed"
    labels:
      dag_id: "$1"

  - match: "*.dagrun.schedule_delay.*"
    match_metric_type: observer
    name: "airflow_dagrun_schedule_delay"
    labels:
      dag_id: "$1"

  - match: "*.scheduler.critical_section_duration"
    match_metric_type: observer
    name: "airflow_scheduler_critical_section_duration"

  - match: "*.dagrun.*.first_task_scheduling_delay"
    match_metric_type: observer
    name: "airflow_dagrun_first_task_scheduling_delay"
    labels:
      dag_id: "$1"

  - match: airflow.dag_processing.last_runtime.*
    name: "airflow_dag_processing_last_runtime"
    labels:
      dag_file: "$1"

  - match: airflow.dag_processing.last_run.seconds_ago.*
    name: "airflow_dag_processing_last_run_seconds_ago"
    match_metric_type: gauge
    labels:
      dag_file: "$1"

  - match: airflow.pool.open_slots.*
    name: "airflow_pool_open_slots"
    match_metric_type: gauge
    labels:
      pool_name: "$1"

  - match: airflow.pool.used_slots.*
    name: "airflow_pool_used_slots"
    match_metric_type: gauge
    labels:
      pool_name: "$1"

  - match: airflow.pool.starving_tasks.*
    name: "airflow_pool_starving_tasks"
    match_metric_type: gauge
    labels:
      pool_name: "$1"

  - match: "*.pool.queued_slots.*"
    match_metric_type: gauge
    name: "airflow_pool_queued_slots"
    labels:
      pool_name: "$1"

  - match: "*.pool.running_slots.*"
    match_metric_type: gauge
    name: "airflow_pool_running_slots"
    labels:
      pool_name: "$1"

  - match: "*.smart_sensor_operator.poked_tasks"
    match_metric_type: gauge
    name: "airflow_smart_sensor_operator_poked_tasks"
  - match: "*.smart_sensor_operator.poked_success"
    match_metric_type: gauge
    name: "airflow_smart_sensor_operator_poked_success"
  - match: "*.smart_sensor_operator.poked_exception"
    match_metric_type: gauge
    name: "airflow_smart_sensor_operator_poked_exception"
  - match: "*.smart_sensor_operator.exception_failures"
    match_metric_type: gauge
    name: "airflow_smart_sensor_operator_exception_failures"
  - match: "*.smart_sensor_operator.infra_failures"
    match_metric_type: gauge
    name: "airflow_smart_sensor_operator_infra_failures"

  - match: "airflow.collect_dags"
    name: "remove"
    # Will be removed in Airflow 2.0
    action: drop

  - match: "airflow.dag_processing.total_parse_time"
    help: Number of seconds taken to process all DAG files
    match_metric_type: gauge
    name: "airflow_dag_processing_time"

  - match: "airflow.dagbag_size"
    help: Number of DAGs
    match_metric_type: gauge
    name: "airflow_dag_count"

  - match: "airflow.dag_processing.import_errors"
    help: The number of errors encountered when processing DAGs
    match_metric_type: gauge
    name: "airflow_dag_errors"

  - match: "airflow.dag.loading-duration.*"
    help: Loading duration of DAGs grouped by file. If multiple DAGs are found in one file, DAG ids are concatenated by an underscore in the label.
    name: "airflow_dag_loading_duration"
    labels:
      dag_ids: "$1"

  - match: "airflow.dag_processing.last_duration.*"
    name: "airflow_dag_processing_last_duration"
    match_metric_type: observer
    labels:
      dag_file: "$1"

  - match: "airflow.executor.open_slots"
    help: The number of open executor slots
    match_metric_type: gauge
    name: "airflow_executor_open_slots"

  - match: "airflow.executor.queued_tasks"
    match_metric_type: gauge
    help: The number of queued tasks
    name: "airflow_executor_queued_tasks"

  - match: "airflow.executor.running_tasks"
    help: The number of running tasks
    match_metric_type: gauge
    name: "airflow_executor_running_tasks"
